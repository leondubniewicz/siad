{
 "cells": [
  {
   "metadata": {},
   "cell_type": "markdown",
   "source": [
    "# This is a sample Jupyter Notebook\n",
    "\n",
    "Below is an example of a code cell. \n",
    "Put your cursor into the cell and press Shift+Enter to execute it and select the next one, or click 'Run Cell' button.\n",
    "\n",
    "Press Double Shift to search everywhere for classes, files, tool windows, actions, and settings.\n",
    "\n",
    "To learn more about Jupyter Notebooks in PyCharm, see [help](https://www.jetbrains.com/help/pycharm/ipython-notebook-support.html).\n",
    "For an overview of PyCharm, go to Help -> Learn IDE features or refer to [our documentation](https://www.jetbrains.com/help/pycharm/getting-started.html)."
   ],
   "id": "8a77807f92f26ee"
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:44:08.264512Z",
     "start_time": "2025-11-05T10:44:06.631450Z"
    }
   },
   "cell_type": "code",
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "from sklearn.preprocessing import OrdinalEncoder,MinMaxScaler\n",
    "from sklearn.compose import ColumnTransformer\n",
    "from sklearn.impute import SimpleImputer\n",
    "from sklearn.neighbors import KNeighborsClassifier\n",
    "from sklearn.model_selection import StratifiedKFold,cross_val_score\n",
    "from sklearn.pipeline import Pipeline\n",
    "\n"
   ],
   "id": "fbc121e30a2defb3",
   "outputs": [],
   "execution_count": 2
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:44:08.288484Z",
     "start_time": "2025-11-05T10:44:08.272073Z"
    }
   },
   "cell_type": "code",
   "source": [
    "data = pd.read_csv('heart_disease_uci.csv', sep=',')\n",
    "data = data.drop(columns='id')\n",
    "y = data['num']\n",
    "X = data.drop(columns='num')\n",
    "data"
   ],
   "id": "4ad6cc22ef5730a1",
   "outputs": [
    {
     "data": {
      "text/plain": [
       "     age     sex        dataset               cp  trestbps   chol    fbs  \\\n",
       "0     63    Male      Cleveland   typical angina     145.0  233.0   True   \n",
       "1     67    Male      Cleveland     asymptomatic     160.0  286.0  False   \n",
       "2     67    Male      Cleveland     asymptomatic     120.0  229.0  False   \n",
       "3     37    Male      Cleveland      non-anginal     130.0  250.0  False   \n",
       "4     41  Female      Cleveland  atypical angina     130.0  204.0  False   \n",
       "..   ...     ...            ...              ...       ...    ...    ...   \n",
       "915   54  Female  VA Long Beach     asymptomatic     127.0  333.0   True   \n",
       "916   62    Male  VA Long Beach   typical angina       NaN  139.0  False   \n",
       "917   55    Male  VA Long Beach     asymptomatic     122.0  223.0   True   \n",
       "918   58    Male  VA Long Beach     asymptomatic       NaN  385.0   True   \n",
       "919   62    Male  VA Long Beach  atypical angina     120.0  254.0  False   \n",
       "\n",
       "              restecg  thalch  exang  oldpeak        slope   ca  \\\n",
       "0      lv hypertrophy   150.0  False      2.3  downsloping  0.0   \n",
       "1      lv hypertrophy   108.0   True      1.5         flat  3.0   \n",
       "2      lv hypertrophy   129.0   True      2.6         flat  2.0   \n",
       "3              normal   187.0  False      3.5  downsloping  0.0   \n",
       "4      lv hypertrophy   172.0  False      1.4    upsloping  0.0   \n",
       "..                ...     ...    ...      ...          ...  ...   \n",
       "915  st-t abnormality   154.0  False      0.0          NaN  NaN   \n",
       "916  st-t abnormality     NaN    NaN      NaN          NaN  NaN   \n",
       "917  st-t abnormality   100.0  False      0.0          NaN  NaN   \n",
       "918    lv hypertrophy     NaN    NaN      NaN          NaN  NaN   \n",
       "919    lv hypertrophy    93.0   True      0.0          NaN  NaN   \n",
       "\n",
       "                  thal  num  \n",
       "0         fixed defect    0  \n",
       "1               normal    2  \n",
       "2    reversable defect    1  \n",
       "3               normal    0  \n",
       "4               normal    0  \n",
       "..                 ...  ...  \n",
       "915                NaN    1  \n",
       "916                NaN    0  \n",
       "917       fixed defect    2  \n",
       "918                NaN    0  \n",
       "919                NaN    1  \n",
       "\n",
       "[920 rows x 15 columns]"
      ],
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>age</th>\n",
       "      <th>sex</th>\n",
       "      <th>dataset</th>\n",
       "      <th>cp</th>\n",
       "      <th>trestbps</th>\n",
       "      <th>chol</th>\n",
       "      <th>fbs</th>\n",
       "      <th>restecg</th>\n",
       "      <th>thalch</th>\n",
       "      <th>exang</th>\n",
       "      <th>oldpeak</th>\n",
       "      <th>slope</th>\n",
       "      <th>ca</th>\n",
       "      <th>thal</th>\n",
       "      <th>num</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>63</td>\n",
       "      <td>Male</td>\n",
       "      <td>Cleveland</td>\n",
       "      <td>typical angina</td>\n",
       "      <td>145.0</td>\n",
       "      <td>233.0</td>\n",
       "      <td>True</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>150.0</td>\n",
       "      <td>False</td>\n",
       "      <td>2.3</td>\n",
       "      <td>downsloping</td>\n",
       "      <td>0.0</td>\n",
       "      <td>fixed defect</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>67</td>\n",
       "      <td>Male</td>\n",
       "      <td>Cleveland</td>\n",
       "      <td>asymptomatic</td>\n",
       "      <td>160.0</td>\n",
       "      <td>286.0</td>\n",
       "      <td>False</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>108.0</td>\n",
       "      <td>True</td>\n",
       "      <td>1.5</td>\n",
       "      <td>flat</td>\n",
       "      <td>3.0</td>\n",
       "      <td>normal</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>67</td>\n",
       "      <td>Male</td>\n",
       "      <td>Cleveland</td>\n",
       "      <td>asymptomatic</td>\n",
       "      <td>120.0</td>\n",
       "      <td>229.0</td>\n",
       "      <td>False</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>129.0</td>\n",
       "      <td>True</td>\n",
       "      <td>2.6</td>\n",
       "      <td>flat</td>\n",
       "      <td>2.0</td>\n",
       "      <td>reversable defect</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>37</td>\n",
       "      <td>Male</td>\n",
       "      <td>Cleveland</td>\n",
       "      <td>non-anginal</td>\n",
       "      <td>130.0</td>\n",
       "      <td>250.0</td>\n",
       "      <td>False</td>\n",
       "      <td>normal</td>\n",
       "      <td>187.0</td>\n",
       "      <td>False</td>\n",
       "      <td>3.5</td>\n",
       "      <td>downsloping</td>\n",
       "      <td>0.0</td>\n",
       "      <td>normal</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>41</td>\n",
       "      <td>Female</td>\n",
       "      <td>Cleveland</td>\n",
       "      <td>atypical angina</td>\n",
       "      <td>130.0</td>\n",
       "      <td>204.0</td>\n",
       "      <td>False</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>172.0</td>\n",
       "      <td>False</td>\n",
       "      <td>1.4</td>\n",
       "      <td>upsloping</td>\n",
       "      <td>0.0</td>\n",
       "      <td>normal</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>915</th>\n",
       "      <td>54</td>\n",
       "      <td>Female</td>\n",
       "      <td>VA Long Beach</td>\n",
       "      <td>asymptomatic</td>\n",
       "      <td>127.0</td>\n",
       "      <td>333.0</td>\n",
       "      <td>True</td>\n",
       "      <td>st-t abnormality</td>\n",
       "      <td>154.0</td>\n",
       "      <td>False</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>916</th>\n",
       "      <td>62</td>\n",
       "      <td>Male</td>\n",
       "      <td>VA Long Beach</td>\n",
       "      <td>typical angina</td>\n",
       "      <td>NaN</td>\n",
       "      <td>139.0</td>\n",
       "      <td>False</td>\n",
       "      <td>st-t abnormality</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>917</th>\n",
       "      <td>55</td>\n",
       "      <td>Male</td>\n",
       "      <td>VA Long Beach</td>\n",
       "      <td>asymptomatic</td>\n",
       "      <td>122.0</td>\n",
       "      <td>223.0</td>\n",
       "      <td>True</td>\n",
       "      <td>st-t abnormality</td>\n",
       "      <td>100.0</td>\n",
       "      <td>False</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>fixed defect</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>918</th>\n",
       "      <td>58</td>\n",
       "      <td>Male</td>\n",
       "      <td>VA Long Beach</td>\n",
       "      <td>asymptomatic</td>\n",
       "      <td>NaN</td>\n",
       "      <td>385.0</td>\n",
       "      <td>True</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>919</th>\n",
       "      <td>62</td>\n",
       "      <td>Male</td>\n",
       "      <td>VA Long Beach</td>\n",
       "      <td>atypical angina</td>\n",
       "      <td>120.0</td>\n",
       "      <td>254.0</td>\n",
       "      <td>False</td>\n",
       "      <td>lv hypertrophy</td>\n",
       "      <td>93.0</td>\n",
       "      <td>True</td>\n",
       "      <td>0.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>920 rows Ã— 15 columns</p>\n",
       "</div>"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "execution_count": 3
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:44:08.302381Z",
     "start_time": "2025-11-05T10:44:08.298424Z"
    }
   },
   "cell_type": "code",
   "source": [
    "print(f'Wszystkich obiektow {y.size}')\n",
    "for column in X.columns:\n",
    "    col = X[column].dropna()\n",
    "    if col.size < y.size:\n",
    "        print(f'{column} - {col.size}')"
   ],
   "id": "fdea0df2a145705b",
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Wszystkich obiektow 920\n",
      "trestbps - 861\n",
      "chol - 890\n",
      "fbs - 830\n",
      "restecg - 918\n",
      "thalch - 865\n",
      "exang - 865\n",
      "oldpeak - 858\n",
      "slope - 611\n",
      "ca - 309\n",
      "thal - 434\n"
     ]
    }
   ],
   "execution_count": 4
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:44:08.359278Z",
     "start_time": "2025-11-05T10:44:08.354095Z"
    }
   },
   "cell_type": "code",
   "source": [
    "transformer = ColumnTransformer(transformers=[('encoder', OrdinalEncoder(), ('sex','dataset','cp','restecg','slope','thal'))], remainder='passthrough')\n",
    "\n",
    "X_enc = transformer.fit_transform(X)\n",
    "X_enc"
   ],
   "id": "20dce4b0a8accd65",
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[1.0, 0.0, 3.0, ..., False, 2.3, 0.0],\n",
       "       [1.0, 0.0, 0.0, ..., True, 1.5, 3.0],\n",
       "       [1.0, 0.0, 0.0, ..., True, 2.6, 2.0],\n",
       "       ...,\n",
       "       [1.0, 3.0, 0.0, ..., False, 0.0, nan],\n",
       "       [1.0, 3.0, 0.0, ..., nan, nan, nan],\n",
       "       [1.0, 3.0, 1.0, ..., True, 0.0, nan]],\n",
       "      shape=(920, 14), dtype=object)"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "execution_count": 5
  },
  {
   "metadata": {},
   "cell_type": "markdown",
   "source": "Brakujace wartosci",
   "id": "78cbe4f5e45dc609"
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:44:08.459432Z",
     "start_time": "2025-11-05T10:44:08.455422Z"
    }
   },
   "cell_type": "code",
   "source": [
    "imp = SimpleImputer(missing_values=np.nan, strategy='mean')\n",
    "X_imp = imp.fit_transform(X_enc)\n",
    "X_imp"
   ],
   "id": "2336b9c10a0fb90",
   "outputs": [
    {
     "data": {
      "text/plain": [
       "array([[1.        , 0.        , 3.        , ..., 0.        , 2.3       ,\n",
       "        0.        ],\n",
       "       [1.        , 0.        , 0.        , ..., 1.        , 1.5       ,\n",
       "        3.        ],\n",
       "       [1.        , 0.        , 0.        , ..., 1.        , 2.6       ,\n",
       "        2.        ],\n",
       "       ...,\n",
       "       [1.        , 3.        , 0.        , ..., 0.        , 0.        ,\n",
       "        0.6763754 ],\n",
       "       [1.        , 3.        , 0.        , ..., 0.38959538, 0.87878788,\n",
       "        0.6763754 ],\n",
       "       [1.        , 3.        , 1.        , ..., 1.        , 0.        ,\n",
       "        0.6763754 ]], shape=(920, 14))"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "execution_count": 6
  },
  {
   "metadata": {},
   "cell_type": "markdown",
   "source": "## Zwykle uczenie",
   "id": "81a76fc21dfdf1ca"
  },
  {
   "metadata": {},
   "cell_type": "markdown",
   "source": "KNN",
   "id": "e8c7539fd8c95587"
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:56:21.803506Z",
     "start_time": "2025-11-05T10:56:21.469118Z"
    }
   },
   "cell_type": "code",
   "source": [
    "params = {'n_neighbors': range(1, 11), 'p':[1,2]}\n",
    "results = {}\n",
    "for n_neighbors in params['n_neighbors']:\n",
    "    for p in params['p']:\n",
    "        pipe = Pipeline([('scaler', MinMaxScaler()),('knn', KNeighborsClassifier(n_neighbors=n_neighbors, p=p))])\n",
    "        score = cross_val_score(pipe,X_imp,y,cv=10)\n",
    "        results[(n_neighbors,p)] = (score.mean(), score.std())\n",
    "\n",
    "results\n",
    "\n"
   ],
   "id": "831ea80f5727adb3",
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{(1, 1): (np.float64(0.49021739130434794), np.float64(0.08863195709520084)),\n",
       " (1, 2): (np.float64(0.5), np.float64(0.11337743313395911)),\n",
       " (2, 1): (np.float64(0.4967391304347826), np.float64(0.07686711829668323)),\n",
       " (2, 2): (np.float64(0.48586956521739133), np.float64(0.08573186537700432)),\n",
       " (3, 1): (np.float64(0.5032608695652174), np.float64(0.10414949448878008)),\n",
       " (3, 2): (np.float64(0.4913043478260869), np.float64(0.11018544258673206)),\n",
       " (4, 1): (np.float64(0.5086956521739131), np.float64(0.09485836621422361)),\n",
       " (4, 2): (np.float64(0.5043478260869565), np.float64(0.0977294208390827)),\n",
       " (5, 1): (np.float64(0.5065217391304349), np.float64(0.09845210325412393)),\n",
       " (5, 2): (np.float64(0.5010869565217392), np.float64(0.10213343323934235)),\n",
       " (6, 1): (np.float64(0.5304347826086957), np.float64(0.10252022715262256)),\n",
       " (6, 2): (np.float64(0.5119565217391304), np.float64(0.0989608102532186)),\n",
       " (7, 1): (np.float64(0.5119565217391304), np.float64(0.10688160154386829)),\n",
       " (7, 2): (np.float64(0.5097826086956522), np.float64(0.10688160154386829)),\n",
       " (8, 1): (np.float64(0.5086956521739131), np.float64(0.1106135150713787)),\n",
       " (8, 2): (np.float64(0.5130434782608696), np.float64(0.10769100936087685)),\n",
       " (9, 1): (np.float64(0.5097826086956522), np.float64(0.10721271014852345)),\n",
       " (9, 2): (np.float64(0.5119565217391304), np.float64(0.09228894585707546)),\n",
       " (10, 1): (np.float64(0.5086956521739131), np.float64(0.10007086336072961)),\n",
       " (10, 2): (np.float64(0.5173913043478261), np.float64(0.09109707321633462))}"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "execution_count": 22
  },
  {
   "metadata": {
    "ExecuteTime": {
     "end_time": "2025-11-05T10:59:37.331339Z",
     "start_time": "2025-11-05T10:59:37.328451Z"
    }
   },
   "cell_type": "code",
   "source": [
    "max_k,max_v = \"\", (0,0)\n",
    "for k,v in results.items():\n",
    "    if v[0] > max_v[0]:\n",
    "        max_k = k\n",
    "        max_v = v\n",
    "print(f'najlepszy wynik dla k={max_k[0]} oraz p={max_k[1]}: {max_v[0]*100:.2f}% +/- {max_v[1]*100:.2f}%')"
   ],
   "id": "7539e14d0f754651",
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "najlepszy wynik dla k=6 oraz p=1: 53.04% +/- 10.25%\n"
     ]
    }
   ],
   "execution_count": 25
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
